{% extends "index.html" %}
{% load static %}
{% load i18n %}
{% load utils %}

{% block section_header %} {% endblock %}


{% block main %}
     <div class="col-12 col-md-12 col-lg-8">
                <div class="card">
                  <div class="padding-20">
                    <form method="post" class="needs-validation">
                            {% csrf_token %}
                          <div class="card-header">
                            <h4>{% translate "Add New Component" %}</h4>
                          </div>
                          <div class="card-body">
                            <div class="row">
                              <div class="form-group col-md-4 col-12">
                                  {{ item_form.part_number.label_tag }}
                                  {% if  item_form.part_number.errors%}
                                      {{ item_form.part_number | attr:"class:form-control is-invalid, required:required"}}
                                  {% else %}
                                     {{ item_form.part_number | attr:"class:form-control, required:required"}}
                                  {% endif %}
                                <div class="invalid-feedback">
                                  {{ item_form.part_number.errors.as_text }}
                                </div>
                              </div>
                              <div class="form-group col-md-4 col-12">
                                  {{ item_form.comment.label_tag }}
                                  {% if  item_form.comment.errors%}
                                      {{ item_form.comment | attr:"class:form-control is-invalid, required:required"}}
                                  {% else %}
                                     {{ item_form.comment | attr:"class:form-control, required:required"}}
                                  {% endif %}
                                <div class="invalid-feedback">
                                  {{ item_form.comment.errors.as_text }}
                                </div>
                              </div>
                              <div class="form-group col-md-4 col-12">
                                  {{ item_form.subcategory.label_tag }}
                                  {% if  item_form.subcategory.errors%}
                                      {{ item_form.subcategory | attr:"class:form-control is-invalid, required:required"}}
                                  {% else %}
                                     {{ item_form.subcategory | attr:"class:form-control, required:required"}}
                                  {% endif %}
                                <div class="invalid-feedback">
                                  {{ item_form.subcategory.errors.as_text }}
                                </div>
                                  <a href="{% url 'items:subcategory_add_popup' item_form.subcategory.id_for_label %}"  onclick="return showAddPopup(this);">
                                      <i class="material-icons">add</i>
                                  </a>
                                  <a href="{% url 'items:subcategory_edit_popup' 0 item_form.subcategory.id_for_label %}"  onclick="return showEditPopup(this);">
                                      <i class="material-icons">edit</i>
                                  </a>
                              </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-4 col-12">
                                    {{ item_form.value.label_tag }}
                                    <div class="form-group">
                                      <div class="input-group">
                                        {{ item_form.value | attr:"class:form-control"}}
                                        {{ item_form.value_units | attr:"class:custom-select" }}
                                      </div>
                                    </div>
                                </div>
                            </div>
                          </div>
                          <div class="card-footer text-right">
                            <button class="btn btn-primary">{% translate "Save Changes" %}</button>
                          </div>
                        </form>
                  </div>
                </div>
              </div>
{% endblock %}


{% block js_libraries %}
{% endblock %}
  <!-- Page Specific JS File -->
{% block page_specific_js %}
    <script type="text/javascript">
        function showEditPopup(triggeringLink) {
            href = triggeringLink.href;
            var parts = href.split('/');
            var lastSegment = parts[parts.length - 1];
            var name = $("#"+lastSegment+" :selected").val();
            parts[parts.length - 2] = name;
            var newurl = parts.join("/");
            var win = window.open(newurl, "Edit",
               'height=500,width=800,resizable=yes,scrollbars=yes');
            win.focus();
            return false;
        }
        function showAddPopup(triggeringLink) {
            href = triggeringLink.href;
            var win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');
            win.focus();
            return false;
        }
        function closePopup(win, newID, newRepr, id) {
            $(id).append('<option value=' + newID + ' selected >' + newRepr + '</option>')
            win.close();
        }

</script>
{% endblock %}

